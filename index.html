<!DOCTYPE html>

<html>

<head>

    <meta charset="utf-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>ICM WebFeeder sample</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="custom.css"/>

</head>

<body>

    <div class="tab__wrap">

        <div class="logo">
            <a href="https://www.icmarkets.com/en/?camp=2060" target="_blank"><img src="logo.png"/> </a>
        </div>

        <ul id="tabs">
            <li><a id="tab1">Forex</a></li>
            <li><a id="tab2">Indices</a></li>
            <li><a id="tab3">Metals</a></li>
        </ul>
        <div class="tab_content" id="tab1C">
            <div id="forex" class="livepriceBox_wrp flx-wrp"></div>
        </div>
        <div class="tab_content" id="tab2C">
            <div id="indices" class="livepriceBox_wrp tb2 flx-wrp"></div>
        </div>
        <div class="tab_content" id="tab3C">
            <div id="metals" class="livepriceBox_wrp tb3 flx-wrp"></div>
        </div>

        <div id="button-container">
            <a href="https://www.icmarkets.com/en/?camp=2060" target="_blank" class="btnBig">Open Live Account</a>
            <div id="separator"></div>
            <a href="https://www.icmarkets.com/en/?camp=2060" target="_blank" class="btnBig live">Open Demo Account</a>
        </div>
    </div>

    <!--Script references. -->

    <!--Reference the jQuery library. -->

    <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.1.3.min.js"></script>

    <script src="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.11.4/jquery-ui.min.js"></script>

    <!--Custom-->
    <script type="text/javascript" src="custom.js"></script>

    <!--Reference the SignalR library. -->

    <script src="http://ajax.aspnetcdn.com/ajax/signalr/jquery.signalr-2.2.0.min.js"></script>

    <!--Add script to update the page and send messages.-->

    <script type="text/javascript">

        $(function () {

            /*http://qfeeder.icm:8080/live/hubs*/

            if(typeof window['jQuery']['signalR']!=='function'){throw new Error('SignalR:\x20SignalR\x20is\x20not\x20loaded.\x20Please\x20ensure\x20jquery.signalR-x.js\x20is\x20referenced\x20before\x20~/signalr/js.');}var signalR=window['jQuery']['signalR'];function makeProxyCallback(a,b){return function(){b['apply'](a,window['jQuery']['makeArray'](arguments));};}function registerHubProxies(c,g){var d,a,b,e,f;for(d in c){if(c['hasOwnProperty'](d)){a=c[d];if(!a['hubName']){continue;}if(g){f=a['on'];}else{f=a['off'];}for(b in a['client']){if(a['client']['hasOwnProperty'](b)){e=a['client'][b];if(!$['isFunction'](e)){continue;}f['call'](a,b,makeProxyCallback(a,e));}}}}}window['jQuery']['hubConnection']['prototype']['createHubProxies']=function(){var a={};this['starting'](function(){registerHubProxies(a,!![]);this['_registerSubscribedHubs']();})['disconnected'](function(){registerHubProxies(a,![]);});a['quotesHub']=this['createHubProxy']('quotesHub');a['quotesHub']['client']={};a['quotesHub']['server']={};return a;};signalR['hub']=window['jQuery']['hubConnection']('/live',{'useDefaultPath':![]});window['jQuery']['extend'](signalR,signalR['hub']['createHubProxies']());



            // set the hubs URL for the connection

            // consists of the address, port (if not 80), and path from the config

            $.connection.hub.url = "https://qfeeder.icmarkets.com:8080/live";

            $.connection.hub.logging = true;

            // specify group

            // if not specified, will be "default"

            $.connection.hub.qs = {
                'group': 'price_widget'
            };



            // override update handler

            // parameter is json object

            // {"Time":1367253023,"Symbol":"EURUSD","Bid":1.35252,"Ask":1.35255}

            // Time - server timestamp

            var containers = {
                forex:   document.getElementById('forex'),
                indices: document.getElementById('indices'),
                metals:  document.getElementById('metals')
            };

            function create (symbol, container) {
                var box = document.createElement('div');
                box.id = symbol;
                box.className = 'live_price_box';

                var wholeWrp = document.createElement('div');
                wholeWrp.className = 'wholeWrp';

                var title = document.createElement('div');
                title.className = 'Title';

                var arrow = document.createElement('div');
                arrow.className = 'arrow';

                var direction = document.createElement('i');
                arrow.appendChild(direction);

                var bid_value = document.createElement('div');
                bid_value.className = 'bid';

                var bid_title = document.createElement('div');
                bid_title.className = 'bid_title';
                bid_title.textContent = 'BID';

                var bid = document.createElement('div');

                var ask_value = document.createElement('div');
                ask_value.className = 'ask';

                var ask_title = document.createElement('div');
                ask_title.className = 'ask_title';
                ask_title.textContent = 'ASK';

                var ask = document.createElement('div');

                var spread_value = document.createElement('div');
                spread_value.className = 'spread';

                var spread_title = document.createElement('div');
                spread_title.className = 'spread_title';
                spread_title.textContent = 'SPREAD';

                var spread = document.createElement('div');

                var date = document.createElement('div');
                date.className = 'date';

                var bid_ask_spread = document.createElement('div');
                bid_ask_spread.className = 'bid_ask_spread';

                bid.appendChild(bid_title);
                bid.appendChild(bid_value);

                ask.appendChild(ask_title);
                ask.appendChild(ask_value);

                spread.appendChild(spread_title);
                spread.appendChild(spread_value);

                bid_ask_spread.appendChild(bid);
                bid_ask_spread.appendChild(ask);
                bid_ask_spread.appendChild(spread);

                wholeWrp.appendChild(title);
                wholeWrp.appendChild(arrow);
                wholeWrp.appendChild(bid_ask_spread);
                wholeWrp.appendChild(date);

                box.appendChild(wholeWrp);

                container.appendChild(box);

                return {
                    box:       box,
                    title:     title,
                    direction: direction,
                    bid:       bid_value,
                    ask:       ask_value,
                    spread:    spread_value,
                    date:      date
                };
            }

            function update (element, quote) {
                element.direction.className = quote.Direction === 1 ? 'fall' : 'rise';
                element.date.textContent = new Date(quote.Time * 1000 + new Date().getTimezoneOffset() * 60 * 1000).toLocaleTimeString();
                element.spread.textContent = Math.round((quote.Ask - quote.Bid) * Math.pow(10, quote.Digits)) / 10;
                element.box.style.color = quote.Direction === 1 ? 'red' : 'green';
                element.title.textContent = quote.Symbol;
                element.bid.textContent = quote.Bid.toFixed(2);
                element.ask.textContent = quote.Ask.toFixed(2);
            }

            var elements = {
                EURUSD: create('EURUSD', containers.forex),
                AUDUSD: create('AUDUSD', containers.forex),
                GBPUSD: create('GBPUSD', containers.forex),
                USDJPY: create('USDJPY', containers.forex),
                USDCAD: create('USDCAD', containers.forex),
                GBPJPY: create('GBPJPY', containers.forex),

                US30:   create('US30',   containers.indices),
                USTEC:  create('USTEC',  containers.indices),
                UK100:  create('UK100',  containers.indices),
                AUS200: create('AUS200', containers.indices),
                JP225:  create('JP225',  containers.indices),
                DE30:   create('DE30',   containers.indices),

                XAGEUR: create('XAGEUR', containers.metals),
                XAGUSD: create('XAGUSD', containers.metals),
                XAUEUR: create('XAUEUR', containers.metals),
                XAUUSD: create('XAUUSD', containers.metals),
                XTIUSD: create('XTIUSD', containers.metals)
            };

            $.connection.quotesHub.client.update = function (quote) {
                var symbol = quote.Symbol.replace(".", "_");
                var element = elements[symbol];

                if (element) update(element, quote);
            };

            $.connection.hub.start().done(function () {
                var $status = $('#status');
                $status.removeClass('alert-warning');
                $status.addClass('alert-success');
                $("#status").html("Connected");
            });

        });

    </script>

</body>

</html>
